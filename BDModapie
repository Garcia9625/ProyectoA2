USE [DBMODAPIE]
GO
/****** Object:  Table [dbo].[ClienteAlDetalle]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ClienteAlDetalle](
	[Dni] [varchar](30) NOT NULL,
	[Nombre] [varchar](50) NULL,
	[Apellido1] [varchar](50) NULL,
	[Apellido2] [varchar](50) NULL,
	[Celular] [varchar](20) NULL,
	[Telefono] [varchar](20) NULL,
	[Correo] [varchar](50)NULL,
PRIMARY KEY CLUSTERED 
(
	[Dni] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ClienteAlxMayor]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ClienteAlxMayor](
	[IdCliente] [int] IDENTITY(1,1) NOT NULL,
	[NombreJuridico] [varchar](100) NULL,
	[NombreFisico] [varchar](50) NULL,
	[NombreFantasia] [varchar](50) NULL,
 CONSTRAINT [PK_ClienteAlxMayor] PRIMARY KEY NONCLUSTERED 
(
	[IdCliente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DecripcionVentaAlxMayor]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DecripcionVentaAlxMayor](
	[IdDetalleVentaDetalle] [int] IDENTITY(1,1) NOT NULL,
	[IdVentaMayor] [int] NULL,
	[IdProducto] [int] NULL,
	[Total] [float] NULL,
PRIMARY KEY CLUSTERED 
(
	[IdDetalleVentaDetalle] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DescripcionVentaAlDetalle]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DescripcionVentaAlDetalle](
	[IdDetalleVentaDetalle] [int] IDENTITY(1,1) NOT NULL,
	[IdVentaDetalle] [int] NULL,
	[IdProducto] [int] NULL,
	[Cantidad] [int] NOT NULL,
	[PrecioUnitario] [float] NULL,
	[Total] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Empleado]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Empleado](
	[Dni] [varchar](30) NOT NULL,
	[Nombre] [varchar](50) NULL,
	[Apellido1] [varchar](50) NULL,
	[Apellido2] [varchar](50) NULL,
	[Celular] [varchar](20) NULL,
	[Telefono] [varchar](20) NULL,
	[Correo][varchar](50) NULL,
	[DireccionDomicilio] [varchar](120) NULL,
	[SalarioMensual] [float] NULL,
	[FechaContratacion] [datetime] NULL,
	[FechaSalida] [datetime] NULL,
	[Estado] [bit] NULL,
PRIMARY KEY CLUSTERED 
(
	[Dni] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[InventarioAlDetalle]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[InventarioAlDetalle](
	[IdProducto] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [varchar](10) NULL,
	[Color] [varchar](10) NULL,
	[Talla] [float] NULL,
	[Descripcion] [varchar](120) NULL,
 CONSTRAINT [PK_InventarioDetalle] PRIMARY KEY NONCLUSTERED 
(
	[IdProducto] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[InventarioAlxMayor]    Script Date: 31/7/2018 12:20:38 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[InventarioAlxMayor](
	[IdLote] [int] NOT NULL,
	[EnvioOrden] [int] NULL,
	[Codigo] [int] NULL,
	[Show] [varchar](10) NULL,
	[Cliente] [varchar](120) NULL,
	[Vendedor] [int] NULL,
	[Zona] [int] NULL,
	[Transporte] [varchar](50) NULL,
	[Pedido] [varchar](10) NULL,
	[Modelo] [int] NULL,
	[Color] [int] NULL,
	[Descripcion] [varchar](200) NULL,
	[Curva] [varchar](20) NULL,
	[Pares] [int] NULL,
	[Cajas] [int] NULL,
	[Cif] [int] NULL,
	[TotalCIF] [int] NULL,
	[PrecioUnitario] [int] NULL,
	[SubTotal] [int] NULL,
	[TotalImpuestos] [int] NULL,
 CONSTRAINT [PK__Inventar__38C4EE9063D52E8D] PRIMARY KEY CLUSTERED 
(
	[IdLote] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Usuario]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Usuario](
	[IdUsuario] [varchar](20) NOT NULL,
	[IdEmpleado] [varchar](30) NULL,
	[Username] [varchar](20) NULL,
	[Password] [varchar](30) NULL,
	[Rol] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[IdUsuario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VentaAlDetalle]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VentaAlDetalle](
	[IdVentaDetalle] [int] IDENTITY(1,1) NOT NULL,
	[IdClienteDetalle] [varchar](30) NULL,
	[IdEmpleado] [varchar](30) NULL,
	[Total] [float] NULL,
 CONSTRAINT [PK_VentaDetalle] PRIMARY KEY NONCLUSTERED 
(
	[IdVentaDetalle] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VentaAlxMayor]    Script Date: 03/07/2018 16:47:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VentaAlxMayor](
	[IdVentaMayor] [int] IDENTITY(1,1) NOT NULL,
	[IdClienteMayor] [int] NULL,
	[IdEmpleado] [varchar](30) NULL,
	[Total] [float] NULL,
PRIMARY KEY CLUSTERED 
(
	[IdVentaMayor] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[DecripcionVentaAlxMayor]  WITH CHECK ADD  CONSTRAINT [FK_DecripcionVentaAlxMayorInventario] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[InventarioAlxMayor] ([IdLote])
GO
ALTER TABLE [dbo].[DecripcionVentaAlxMayor] CHECK CONSTRAINT [FK_DecripcionVentaAlxMayorInventario]
GO
ALTER TABLE [dbo].[DecripcionVentaAlxMayor]  WITH CHECK ADD  CONSTRAINT [FK_DecripcionVentaAlxMayorVenta] FOREIGN KEY([IdVentaMayor])
REFERENCES [dbo].[VentaAlxMayor] ([IdVentaMayor])
GO
ALTER TABLE [dbo].[DecripcionVentaAlxMayor] CHECK CONSTRAINT [FK_DecripcionVentaAlxMayorVenta]
GO
ALTER TABLE [dbo].[DescripcionVentaAlDetalle]  WITH CHECK ADD FOREIGN KEY([IdVentaDetalle])
REFERENCES [dbo].[VentaAlDetalle] ([IdVentaDetalle])
GO
ALTER TABLE [dbo].[DescripcionVentaAlDetalle]  WITH CHECK ADD  CONSTRAINT [FK_DescripcionVentaDetalleInventarioDetalle] FOREIGN KEY([IdProducto])
REFERENCES [dbo].[InventarioAlDetalle] ([IdProducto])
GO
ALTER TABLE [dbo].[DescripcionVentaAlDetalle] CHECK CONSTRAINT [FK_DescripcionVentaDetalleInventarioDetalle]
GO
ALTER TABLE [dbo].[Usuario]  WITH CHECK ADD  CONSTRAINT [FK_Empleado] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleado] ([Dni])
GO
ALTER TABLE [dbo].[Usuario] CHECK CONSTRAINT [FK_Empleado]
GO
ALTER TABLE [dbo].[VentaAlDetalle]  WITH CHECK ADD  CONSTRAINT [FK_VentaDetalleCliente] FOREIGN KEY([IdClienteDetalle])
REFERENCES [dbo].[ClienteAlDetalle] ([Dni])
GO
ALTER TABLE [dbo].[VentaAlDetalle] CHECK CONSTRAINT [FK_VentaDetalleCliente]
GO
ALTER TABLE [dbo].[VentaAlDetalle]  WITH CHECK ADD  CONSTRAINT [FK_VentaDetalleEmpleado] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleado] ([Dni])
GO
ALTER TABLE [dbo].[VentaAlDetalle] CHECK CONSTRAINT [FK_VentaDetalleEmpleado]
GO
ALTER TABLE [dbo].[VentaAlxMayor]  WITH CHECK ADD  CONSTRAINT [FK_VentaAlxMayorCliente] FOREIGN KEY([IdClienteMayor])
REFERENCES [dbo].[ClienteAlxMayor] ([IdCliente])
GO
ALTER TABLE [dbo].[VentaAlxMayor] CHECK CONSTRAINT [FK_VentaAlxMayorCliente]
GO
ALTER TABLE [dbo].[VentaAlxMayor]  WITH CHECK ADD  CONSTRAINT [FK_VentaAlxMayorEmpleado] FOREIGN KEY([IdEmpleado])
REFERENCES [dbo].[Empleado] ([Dni])
GO
ALTER TABLE [dbo].[VentaAlxMayor] CHECK CONSTRAINT [FK_VentaAlxMayorEmpleado]
GO



/****** PL/SQL ******/
****Stored Procedures****

USE [DBMODAPIE]
GO
/** Object:  StoredProcedure [dbo].[validarUser]    Script Date: 17/7/2018 12:19:50 **/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[validarUser] 
@Username varchar(50)
AS
BEGIN
SET NOCOUNT ON;
SELECT IdUsuario, IdEmpleado,Username,Password, Rol
From Usuario
Where Username = @Username;
END
GO


Create PROCEDURE [dbo].[sp_InsertarCAXM] 
@NombreJuridico varchar(100),
@NombreFisico varchar(50),
@NombreFantasia varchar(50)
AS
BEGIN
SET NOCOUNT ON;
INSERT INTO ClienteAlxMayor (NombreJuridico,NombreFisico,NombreFantasia)
VALUES        (@NombreJuridico,@NombreFisico,@NombreFantasia);
END
GO


CREATE PROCEDURE [dbo].[sp_MostrarCAXM] 
AS
BEGIN
SET NOCOUNT ON;
SELECT * from [dbo].[ClienteAlxMayor];
END
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_Editar] 
@IdCliente int, 
@NombreJuridico varchar(100),
@NombreFisico varchar(50),
@NombreFantasia varchar(50)
AS
BEGIN
	SET NOCOUNT ON;

UPDATE      ClienteAlxMayor
SET          
			NombreJuridico = @NombreJuridico,
            NombreFisico = @NombreFisico, 
			NombreFantasia = @NombreFantasia
WHERE       (IdCliente = @IdCliente);
END
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_EliminarCAXM]
@IdCliente int
AS
BEGIN
SET NOCOUNT ON;	 
delete FROM  ClienteAlxMayor
WHERE        (IdCliente = @IdCliente);
END
GO



/**Gestion cliente al Detalle**/


/****** Object:  StoredProcedure [dbo].[sp_InsertarCAD]    Script Date: 07/08/2018 12:42:22 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


Create PROCEDURE [dbo].[sp_InsertarCAD] 
@Dni varchar(20),
@Nombre varchar(50),
@Apellido1 varchar(50),
@Apellido2 varchar(50),
@Celular varchar(20),
@Telefono varchar(20),
@Correo varchar (50)
AS
BEGIN
SET NOCOUNT ON;
INSERT INTO ClienteAlDetalle (Dni,Nombre,Apellido1,Apellido2,Celular,Telefono,Correo)
VALUES        (@Dni,@Nombre,@Apellido1,@Apellido2,@Celular,@Telefono,@Correo);
END

GO


/****** Object:  StoredProcedure [dbo].[MostrarCAD]    Script Date: 07/08/2018 12:45:02 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

 CREATE  PROCEDURE [dbo].[MostrarCAD] 

@ID int

AS

BEGIN

SET NOCOUNT ON;

SELECT Dni,Nombre,Apellido1,Apellido2,Celular,Telefono,Correo

From ClienteAlDetalle

Where @ID=Dni;

END

GO




/**Final Gestio cliente al detalle**/

/**Gestion de Empleado**/
Create PROCEDURE [dbo].[sp_InsertarEmpleado] 
@Dni varchar(30),
@Nombre varchar(50),
@Apellido1 varchar(50),
@Apellido2 varchar(50),
@Celular varchar(20),
@Telefono varchar(20),
@Correo varchar(50),
@DireccionDomicilio varchar(120),
@SalarioMensual float,
@FechaContratacion datetime,
@Estado bit
AS
BEGIN
SET NOCOUNT ON;
INSERT INTO Empleado(Dni,Nombre,Apellido1, Apellido2, Celular,Telefono,Correo,DireccionDomicilio,SalarioMensual,FechaContratacion,Estado)
VALUES        (@Dni,@Nombre,@Apellido1,@Apellido2,@Celular,@Telefono,@Correo,@DireccionDomicilio,@SalarioMensual,@FechaContratacion,@Estado);
END
GO

CREATE PROCEDURE [dbo].[sp_MostrarEmpleado] 
AS
BEGIN
SET NOCOUNT ON;
SELECT * from [dbo].[Empleado];
END
GO

CREATE PROCEDURE [dbo].[sp_BuscarEmpleado] 
@Dni varchar(30)
AS
BEGIN
SET NOCOUNT ON;
SELECT * from [dbo].[Empleado] where Dni = @Dni;
END
GO


Create PROCEDURE [dbo].[sp_ActualizarEmpleado] 
@Dni varchar(30),
@Nombre varchar(50),
@Apellido1 varchar(50),
@Apellido2 varchar(50),
@Celular varchar(20),
@Telefono varchar(20),
@Correo varchar(50),
@DireccionDomicilio varchar(120),
@SalarioMensual float,
@FechaContratacion datetime,
@Estado bit
AS
BEGIN
SET NOCOUNT ON;
Update Empleado set Nombre = @Nombre,Apellido1 = @Apellido1, Apellido2 = @Apellido2, Celular = @Celular, Telefono = @Telefono, 
Correo = @Correo, DireccionDomicilio = @DireccionDomicilio, SalarioMensual = @SalarioMensual, FechaContratacion = @FechaContratacion, Estado = @Estado where Dni = @Dni;
END
GO

/**Fin de Gestion de Empleado**/

/****** Object:  StoredProcedure [dbo].[MostrarProductoAlxMayor1]    Script Date: 31/7/2018 12:25:31 ******/
SET ANSI_NULLS ON
GO
CREATE  PROCEDURE [dbo].[MostrarProductoAlxMayor1] 
@IdLote int
AS
BEGIN
SET NOCOUNT ON;
SELECT IdLote,EnvioOrden,Codigo,Show,Cliente,Vendedor,Zona,Transporte,Pedido,Modelo,Color,
Descripcion,Curva,Pares,Cajas,Cif,TotalCIF,PrecioUnitario,SubTotal,TotalImpuestos
From InventarioAlxMayor
Where IdLote = @IdLote;
END
GO


/****** Object:  StoredProcedure [dbo].[sp_EliminarCAXM]    Script Date: 31/7/2018 12:40:19 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_EliminarProdxMayor]
@id int
AS
BEGIN
SET NOCOUNT ON;	 
delete FROM  InventarioAlxMayor
Where IdLote = @id;
END
GO




***Functions***
Create Function Rol(
@NOMBRE varchar(50)
)
returns int
AS
BEGIN
declare @value int;

SELECT @value = Rol FROM Usuario WHERE Username = @NOMBRE;
IF (@value IS NULL)   
        SET @value = 0;  
    RETURN @value;
end 
go


USE [DBMODAPIE]
GO

/** Object:  UserDefinedFunction [dbo].[Validacion_Login]    Script Date: 15/07/2018 22:38:30 **/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE FUNCTION [dbo].[Validacion_Login] (@Username varchar(20), @Password varchar(30))
RETURNS int
AS 
BEGIN
declare @value int = 0;

IF EXISTS(SELECT * FROM USUARIO WHERE Username = @Username AND Password = @Password)
    Set @Value = @Value + 1
ELSE IF EXISTS(SELECT * FROM USUARIO WHERE Username = @Username AND Password != @Password)
    Set @Value = @Value + 0
ELSE
    Set @Value = @Value + 2

return @value
END
GO


*******Sentencias SQL para tabla Empleado y Usuario

INSERT INTO Empleado VALUES (1, 'mariana', 'hernandez', 'quesada', 54545454, 54545454, 'curri', 500000, '2015-12-17', '2020-12-17', 1);

INSERT INTO Usuario VALUES (1, 1, 'mari', '123', 1);
